# ğŸ“Š è©•ä¼°æŒ‡æ¨™æ–‡æª” (Evaluation Metrics)

æœ¬æ–‡æª”è©³ç´°èªªæ˜æœ¬å°ˆæ¡ˆä¸­æ‰€æœ‰è©•ä¼°æŒ‡æ¨™çš„æ•¸å­¸å…¬å¼èˆ‡å¯¦ç¾é‚è¼¯ã€‚

---

## ğŸ“‹ ç›®éŒ„

1. [æ’åºå“è³ªæŒ‡æ¨™ (Ranking Metrics)](#æ’åºå“è³ªæŒ‡æ¨™)
   - Hit Rate@K
   - Precision@K
   - Recall@K
   - MRR (Mean Reciprocal Rank)
   - NDCG@K (Normalized Discounted Cumulative Gain)

2. [é æ¸¬æº–ç¢ºåº¦æŒ‡æ¨™ (Prediction Metrics)](#é æ¸¬æº–ç¢ºåº¦æŒ‡æ¨™)
   - RMSE (Root Mean Squared Error)
   - MAE (Mean Absolute Error)

3. [Leave-One-Out è©•ä¼°ç­–ç•¥](#leave-one-out-è©•ä¼°ç­–ç•¥)

---

## ğŸ¯ æ’åºå“è³ªæŒ‡æ¨™ (Ranking Metrics)

é€™äº›æŒ‡æ¨™è©•ä¼°æ¨è–¦ç³»çµ±çš„**æ’åºèƒ½åŠ›**ï¼Œå³èƒ½å¦å°‡ä½¿ç”¨è€…çœŸæ­£å–œæ­¡çš„é …ç›®æ’åœ¨å‰é¢ã€‚

---

### 1. Hit Rate@Kï¼ˆå‘½ä¸­ç‡ï¼‰

**å®šç¾©**ï¼šåœ¨ Top-K æ¨è–¦åˆ—è¡¨ä¸­ï¼Œæ˜¯å¦è‡³å°‘å‘½ä¸­ä¸€å€‹ç›¸é—œé …ç›®ã€‚

#### æ•¸å­¸å…¬å¼

å°æ–¼å–®ä¸€ä½¿ç”¨è€…ï¼š

$$
\text{Hit@K}(u) = 
\begin{cases}
1 & \text{if } |\text{Rec}_K(u) \cap \text{Rel}(u)| \geq 1 \\
0 & \text{otherwise}
\end{cases}
$$

å°æ–¼æ‰€æœ‰ä½¿ç”¨è€…çš„å¹³å‡ï¼š

$$
\text{Hit Rate@K} = \frac{1}{|U|} \sum_{u \in U} \text{Hit@K}(u)
$$

å…¶ä¸­ï¼š
- $\text{Rec}_K(u)$ï¼šæ¨è–¦çµ¦ä½¿ç”¨è€… $u$ çš„å‰ $K$ å€‹é …ç›®
- $\text{Rel}(u)$ï¼šä½¿ç”¨è€… $u$ çš„ç›¸é—œé …ç›®é›†åˆ
- $|U|$ï¼šä½¿ç”¨è€…ç¸½æ•¸

#### ç¨‹å¼å¯¦ç¾

```python
def hit_rate_at_k(self, recommended: List[int], relevant: List[int], k: int) -> int:
    recommended_k = recommended[:k]
    return int(bool(set(recommended_k) & set(relevant)))
```

**è©•ä¼°å‡½æ•¸ä¸­çš„è¨ˆç®—**ï¼š

```python
# å–®ä¸€æ¨£æœ¬
if target_movie_idx in recommended:
    hits += 1  # å‘½ä¸­

# æœ€çµ‚çµæœ
hit_rate = hits / valid_samples
```

#### è§£è®€
- **ç¯„åœ**ï¼š0.0 ~ 1.0
- **è¶Šé«˜è¶Šå¥½**
- **0.668** è¡¨ç¤ºï¼š66.8% çš„æ¸¬è©¦ä½¿ç”¨è€…ï¼Œå…¶æœ€å–œæ­¡çš„é›»å½±å‡ºç¾åœ¨ Top-10 æ¨è–¦ä¸­
- **é©ç”¨å ´æ™¯**ï¼šè©•ä¼°æ¨è–¦ç³»çµ±çš„ã€Œè¦†è“‹ç‡ã€ï¼Œæ˜¯æœ€å¸¸ç”¨çš„é›¢ç·šè©•ä¼°æŒ‡æ¨™

---

### 2. Precision@Kï¼ˆç²¾ç¢ºç‡ï¼‰

**å®šç¾©**ï¼šTop-K æ¨è–¦åˆ—è¡¨ä¸­ï¼Œç›¸é—œé …ç›®çš„æ¯”ä¾‹ã€‚

#### æ•¸å­¸å…¬å¼

$$
\text{Precision@K} = \frac{|\text{Rec}_K \cap \text{Rel}|}{K}
$$

#### ç¨‹å¼å¯¦ç¾

```python
def precision_at_k(self, recommended: List[int], relevant: List[int], k: int) -> float:
    recommended_k = recommended[:k]
    hits = len(set(recommended_k) & set(relevant))
    return hits / k if k > 0 else 0.0
```

**Leave-One-Out å ´æ™¯ä¸‹çš„ç°¡åŒ–**ï¼š

```python
precision = hit_rate / top_n
```

å› ç‚ºåœ¨ Leave-One-Out ä¸­ï¼Œæ¯å€‹ä½¿ç”¨è€…åªæœ‰**1å€‹ç›¸é—œé …ç›®**ï¼š
- å¦‚æœå‘½ä¸­ï¼š$\text{Precision} = 1/K$
- å¦‚æœæœªå‘½ä¸­ï¼š$\text{Precision} = 0$
- å¹³å‡ï¼š$\text{Precision} = \text{Hit Rate} / K$

#### è§£è®€
- **ç¯„åœ**ï¼š0.0 ~ 1.0
- **è¶Šé«˜è¶Šå¥½**
- **0.0668**ï¼ˆK=10ï¼‰è¡¨ç¤ºï¼šå¹³å‡æ¯ 10 å€‹æ¨è–¦ä¸­æœ‰ 0.668 å€‹æ˜¯ç›¸é—œçš„
- **é©ç”¨å ´æ™¯**ï¼šè©•ä¼°æ¨è–¦åˆ—è¡¨çš„ã€Œç´”åº¦ã€

---

### 3. Recall@Kï¼ˆå¬å›ç‡ï¼‰

**å®šç¾©**ï¼šæ‰€æœ‰ç›¸é—œé …ç›®ä¸­ï¼Œæœ‰å¤šå°‘è¢«æ¨è–¦åˆ° Top-K ä¸­ã€‚

#### æ•¸å­¸å…¬å¼

$$
\text{Recall@K} = \frac{|\text{Rec}_K \cap \text{Rel}|}{|\text{Rel}|}
$$

#### ç¨‹å¼å¯¦ç¾

```python
def recall_at_k(self, recommended: List[int], relevant: List[int], k: int) -> float:
    recommended_k = recommended[:k]
    hits = len(set(recommended_k) & set(relevant))
    return hits / len(relevant) if relevant else 0.0
```

**Leave-One-Out å ´æ™¯ä¸‹çš„ç°¡åŒ–**ï¼š

```python
recall = hit_rate  # For Leave-One-Out with single target
```

å› ç‚ºåœ¨ Leave-One-Out ä¸­ï¼Œæ¯å€‹ä½¿ç”¨è€…åªæœ‰**1å€‹ç›¸é—œé …ç›®**ï¼š
- å¦‚æœå‘½ä¸­ï¼š$\text{Recall} = 1/1 = 1.0$
- å¦‚æœæœªå‘½ä¸­ï¼š$\text{Recall} = 0/1 = 0.0$
- å¹³å‡ï¼š$\text{Recall} = \text{Hit Rate}$

#### è§£è®€
- **ç¯„åœ**ï¼š0.0 ~ 1.0
- **è¶Šé«˜è¶Šå¥½**
- åœ¨ Leave-One-Out å ´æ™¯ä¸­ï¼Œ**Recall = Hit Rate**
- **é©ç”¨å ´æ™¯**ï¼šè©•ä¼°æ¨è–¦ç³»çµ±æ˜¯å¦ã€Œéºæ¼ã€é‡è¦é …ç›®

---

### 4. MRRï¼ˆMean Reciprocal Rankï¼‰

**å®šç¾©**ï¼šç¬¬ä¸€å€‹ç›¸é—œé …ç›®çš„æ’åä½ç½®çš„å€’æ•¸ï¼Œå¼·èª¿ã€Œè¶Šæ—©å‘½ä¸­è¶Šå¥½ã€ã€‚

#### æ•¸å­¸å…¬å¼

å°æ–¼å–®ä¸€ä½¿ç”¨è€…ï¼š

$$
\text{RR}(u) = 
\begin{cases}
\frac{1}{\text{rank}_u} & \text{if relevant item found} \\
0 & \text{otherwise}
\end{cases}
$$

å°æ–¼æ‰€æœ‰ä½¿ç”¨è€…çš„å¹³å‡ï¼š

$$
\text{MRR} = \frac{1}{|U|} \sum_{u \in U} \text{RR}(u)
$$

å…¶ä¸­ $\text{rank}_u$ æ˜¯ä½¿ç”¨è€… $u$ çš„ç¬¬ä¸€å€‹ç›¸é—œé …ç›®åœ¨æ¨è–¦åˆ—è¡¨ä¸­çš„ä½ç½®ï¼ˆå¾1é–‹å§‹ï¼‰ã€‚

#### ç¨‹å¼å¯¦ç¾

```python
def mrr(self, recommended: List[int], relevant: List[int]) -> float:
    for i, item in enumerate(recommended):
        if item in relevant:
            return 1.0 / (i + 1)  # iæ˜¯0-indexedï¼Œæ‰€ä»¥+1
    return 0.0
```

**è©•ä¼°å‡½æ•¸ä¸­çš„è¨ˆç®—**ï¼š

```python
if target_movie_idx in recommended:
    rank = recommended.index(target_movie_idx) + 1
    reciprocal_ranks.append(1.0 / rank)
else:
    reciprocal_ranks.append(0.0)

# æœ€çµ‚çµæœ
mrr = np.mean(reciprocal_ranks)
```

#### ç¤ºä¾‹

| æ’åä½ç½® | Reciprocal Rank | å«ç¾© |
| --- | --- | --- |
| ç¬¬1ä½ | 1.0 | å®Œç¾å‘½ä¸­ |
| ç¬¬2ä½ | 0.5 | è‰¯å¥½ |
| ç¬¬3ä½ | 0.333 | å°šå¯ |
| ç¬¬10ä½ | 0.1 | è¼ƒå·® |
| æœªå‘½ä¸­ | 0.0 | å¤±æ•— |

#### è§£è®€
- **ç¯„åœ**ï¼š0.0 ~ 1.0
- **è¶Šé«˜è¶Šå¥½**
- **MRR = 0.45** è¡¨ç¤ºï¼šå¹³å‡è€Œè¨€ï¼Œç¬¬ä¸€å€‹ç›¸é—œé …ç›®å‡ºç¾åœ¨ç¬¬ 1/0.45 â‰ˆ 2.2 ä½
- **é©ç”¨å ´æ™¯**ï¼šç•¶åªé—œå¿ƒã€Œç¬¬ä¸€å€‹å‘½ä¸­ã€çš„å ´æ™¯ï¼ˆå¦‚æœå°‹å¼•æ“ã€å–®ä¸€æ¨è–¦ï¼‰

---

### 5. NDCG@Kï¼ˆNormalized Discounted Cumulative Gainï¼‰

**å®šç¾©**ï¼šè€ƒæ…®ç›¸é—œæ€§ç¨‹åº¦èˆ‡æ’åºä½ç½®çš„ç¶œåˆæŒ‡æ¨™ï¼Œä½ç½®è¶Šå‰æ¬Šé‡è¶Šé«˜ã€‚

#### å®Œæ•´æ•¸å­¸å…¬å¼

**DCG@Kï¼ˆDiscounted Cumulative Gainï¼‰**ï¼š

$$
\text{DCG@K} = \sum_{i=1}^{K} \frac{2^{rel_i} - 1}{\log_2(i + 1)}
$$

**IDCG@Kï¼ˆIdeal DCGï¼‰**ï¼š

å°‡æ‰€æœ‰ç›¸é—œé …ç›®æŒ‰æœ€ç†æƒ³é †åºæ’åˆ—ï¼ˆç›¸é—œåº¦å¾é«˜åˆ°ä½ï¼‰å¾Œçš„ DCG å€¼ã€‚

$$
\text{IDCG@K} = \sum_{i=1}^{\min(|Rel|, K)} \frac{2^{rel_i^*} - 1}{\log_2(i + 1)}
$$

å…¶ä¸­ $rel_i^*$ æ˜¯ç†æƒ³æ’åºä¸‹çš„ç›¸é—œåº¦ã€‚

**NDCG@Kï¼ˆæ­¸ä¸€åŒ–ï¼‰**ï¼š

$$
\text{NDCG@K} = \frac{\text{DCG@K}}{\text{IDCG@K}}
$$

#### Binary Relevance ç°¡åŒ–ï¼ˆæœ¬å°ˆæ¡ˆæ¡ç”¨ï¼‰

ç•¶ç›¸é—œæ€§ç‚ºäºŒå…ƒï¼ˆ0æˆ–1ï¼‰æ™‚ï¼š
- $2^1 - 1 = 1$ï¼ˆç›¸é—œï¼‰
- $2^0 - 1 = 0$ï¼ˆä¸ç›¸é—œï¼‰

ç°¡åŒ–ç‚ºï¼š

$$
\text{DCG@K} = \sum_{i=1}^{K} \frac{rel_i}{\log_2(i + 1)}
$$

#### Leave-One-Out å ´æ™¯çš„ç‰¹æ®Šæƒ…æ³

åœ¨ Leave-One-Out ä¸­ï¼Œæ¯å€‹ä½¿ç”¨è€…åªæœ‰**1å€‹ç›¸é—œé …ç›®**ï¼š

- **DCG@K**ï¼šå¦‚æœç›¸é—œé …ç›®åœ¨ç¬¬ $r$ ä½ï¼š
  $$\text{DCG@K} = \frac{1}{\log_2(r + 1)}$$

- **IDCG@K**ï¼šç†æƒ³æƒ…æ³ä¸‹ç›¸é—œé …ç›®åœ¨ç¬¬1ä½ï¼š
  $$\text{IDCG@K} = \frac{1}{\log_2(2)} = 1.0$$

- **NDCG@K**ï¼š
  $$\text{NDCG@K} = \frac{1}{\log_2(r + 1)}$$

#### ç¨‹å¼å¯¦ç¾

**é€šç”¨ç‰ˆæœ¬**ï¼š
```python
def ndcg_at_k(self, recommended: List[int], relevant: List[int], k: int) -> float:
    recommended_k = recommended[:k]
    
    # DCG: For binary relevance (0/1)
    dcg = 0.0
    for i, item in enumerate(recommended_k):
        if item in relevant:
            # iæ˜¯0-indexedï¼Œposition = i+1
            # log2(position + 1) = log2(i + 2)
            dcg += 1.0 / np.log2(i + 2)
    
    # IDCG: å°æ–¼å–®ä¸€ç›¸é—œé …ç›® = 1.0 / log2(2) = 1.0
    idcg = 1.0
    
    return dcg / idcg if idcg > 0 else 0.0
```

**Leave-One-Out è©•ä¼°ä¸­çš„ç›´æ¥è¨ˆç®—**ï¼š
```python
if target_movie_idx in recommended:
    rank = recommended.index(target_movie_idx) + 1
    # NDCG = DCG / IDCG = [1.0 / log2(rank+1)] / 1.0
    ndcg_scores.append(1.0 / np.log2(rank + 1))
else:
    ndcg_scores.append(0.0)

# æœ€çµ‚çµæœ
ndcg = np.mean(ndcg_scores)
```

#### ç¤ºä¾‹è¨ˆç®—

å‡è¨­ Top-10 æ¨è–¦åˆ—è¡¨ï¼Œç›¸é—œé …ç›®åœ¨ç¬¬3ä½ï¼š

| ä½ç½® | æ˜¯å¦ç›¸é—œ | DCG è²¢ç» | è¨ˆç®— |
| --- | --- | --- | --- |
| 1 | âŒ | 0 | - |
| 2 | âŒ | 0 | - |
| 3 | âœ… | 0.5 | 1 / logâ‚‚(4) = 1 / 2 |
| 4-10 | âŒ | 0 | - |

- DCG@10 = 0.5
- IDCG@10 = 1.0ï¼ˆç†æƒ³æƒ…æ³ï¼šç›¸é—œé …ç›®åœ¨ç¬¬1ä½ï¼‰
- **NDCG@10 = 0.5 / 1.0 = 0.5**

#### ä¸åŒæ’åçš„ NDCG å€¼

| æ’åä½ç½® | logâ‚‚(rank+1) | NDCG å€¼ |
| --- | --- | --- |
| ç¬¬1ä½ | logâ‚‚(2) = 1.0 | **1.000** âœ¨ å®Œç¾ |
| ç¬¬2ä½ | logâ‚‚(3) â‰ˆ 1.585 | **0.631** |
| ç¬¬3ä½ | logâ‚‚(4) = 2.0 | **0.500** |
| ç¬¬4ä½ | logâ‚‚(5) â‰ˆ 2.322 | **0.431** |
| ç¬¬5ä½ | logâ‚‚(6) â‰ˆ 2.585 | **0.387** |
| ç¬¬10ä½ | logâ‚‚(11) â‰ˆ 3.459 | **0.289** |
| æœªå‘½ä¸­ | - | **0.000** âŒ |

#### è§£è®€
- **ç¯„åœ**ï¼š0.0 ~ 1.0
- **è¶Šé«˜è¶Šå¥½**
- **NDCG = 0.528** è¡¨ç¤ºï¼šæ¨è–¦æ’åºå“è³ªé”åˆ°ç†æƒ³æ’åºçš„ 52.8%
- **ç‰¹é»**ï¼š
  - è€ƒæ…®æ’åºä½ç½®ï¼ˆå‰é¢çš„ä½ç½®æ¬Šé‡æ›´é«˜ï¼‰
  - ç›¸å° Hit Rate æ›´åš´æ ¼ï¼ˆä¸åƒ…è¦å‘½ä¸­ï¼Œé‚„è¦æ’åœ¨å‰é¢ï¼‰
  - NDCG > 0.5 è¢«èªç‚ºæ˜¯**å„ªç§€**çš„æ’åºå“è³ª
- **é©ç”¨å ´æ™¯**ï¼šè©•ä¼°æ¨è–¦åˆ—è¡¨çš„**æ’åºå“è³ª**ï¼Œæ¥­ç•Œæœ€å¸¸ç”¨çš„æ’åºæŒ‡æ¨™

---

## ğŸ“‰ é æ¸¬æº–ç¢ºåº¦æŒ‡æ¨™ (Prediction Metrics)

é€™äº›æŒ‡æ¨™è©•ä¼°æ¨è–¦ç³»çµ±çš„**è©•åˆ†é æ¸¬èƒ½åŠ›**ï¼Œå³èƒ½å¦æº–ç¢ºé æ¸¬ä½¿ç”¨è€…å°é …ç›®çš„è©•åˆ†ã€‚

---

### 6. RMSEï¼ˆRoot Mean Squared Errorï¼‰

**å®šç¾©**ï¼šçœŸå¯¦è©•åˆ†èˆ‡é æ¸¬è©•åˆ†çš„å‡æ–¹æ ¹èª¤å·®ï¼Œå°å¤§èª¤å·®æ‡²ç½°æ›´é‡ã€‚

#### æ•¸å­¸å…¬å¼

$$
\text{RMSE} = \sqrt{\frac{1}{N} \sum_{i=1}^{N} (r_i - \hat{r}_i)^2}
$$

å…¶ä¸­ï¼š
- $r_i$ï¼šçœŸå¯¦è©•åˆ†
- $\hat{r}_i$ï¼šé æ¸¬è©•åˆ†
- $N$ï¼šè©•åˆ†æ•¸é‡

#### ç¨‹å¼å¯¦ç¾

```python
def rmse(self, true_ratings: np.ndarray, predicted_ratings: np.ndarray) -> float:
    return np.sqrt(np.mean((true_ratings - predicted_ratings) ** 2))
```

**è©•ä¼°å‡½æ•¸ä¸­çš„è¨ˆç®—**ï¼š

```python
# æ”¶é›†èª¤å·®
squared_errors.append((true_rating - pred_rating) ** 2)

# æœ€çµ‚çµæœ
rmse = np.sqrt(np.mean(squared_errors))
```

#### è§£è®€
- **ç¯„åœ**ï¼š0 ~ âˆï¼ˆå¯¦éš›é€šå¸¸åœ¨ 0 ~ 5 ä¹‹é–“ï¼Œå°æ‡‰è©•åˆ†ç¯„åœï¼‰
- **è¶Šä½è¶Šå¥½**
- **RMSE = 0.9753** è¡¨ç¤ºï¼šå¹³å‡é æ¸¬èª¤å·®ç´„ç‚º 0.98 æ˜Ÿ
- **ç‰¹é»**ï¼š
  - å°å¤§èª¤å·®æ•æ„Ÿï¼ˆå¹³æ–¹é …æ”¾å¤§èª¤å·®ï¼‰
  - å–®ä½èˆ‡åŸå§‹è©•åˆ†ç›¸åŒï¼ˆæ˜Ÿç´šï¼‰
  - RMSE < 1.0 è¢«èªç‚ºæ˜¯**å„ªç§€**çš„é æ¸¬æº–ç¢ºåº¦
- **é©ç”¨å ´æ™¯**ï¼šè©•ä¼°è©•åˆ†é æ¸¬çš„æº–ç¢ºæ€§ï¼ŒNetflix Prize ç«¶è³½çš„å®˜æ–¹æŒ‡æ¨™

#### èª¤å·®ç¤ºä¾‹

| çœŸå¯¦è©•åˆ† | é æ¸¬è©•åˆ† | èª¤å·® | å¹³æ–¹èª¤å·® |
| --- | --- | --- | --- |
| 5.0 | 4.8 | 0.2 | 0.04 |
| 4.0 | 3.5 | 0.5 | 0.25 |
| 3.5 | 4.0 | -0.5 | 0.25 |
| 5.0 | 3.0 | 2.0 | **4.00** âš ï¸ |

æ³¨æ„ï¼šRMSE å°å¤§èª¤å·®ï¼ˆ2.0æ˜Ÿï¼‰çš„æ‡²ç½°é é«˜æ–¼å°èª¤å·®ã€‚

---

### 7. MAEï¼ˆMean Absolute Errorï¼‰

**å®šç¾©**ï¼šçœŸå¯¦è©•åˆ†èˆ‡é æ¸¬è©•åˆ†çš„å¹³å‡çµ•å°èª¤å·®ï¼Œå°æ‰€æœ‰èª¤å·®ä¸€è¦–åŒä»ã€‚

#### æ•¸å­¸å…¬å¼

$$
\text{MAE} = \frac{1}{N} \sum_{i=1}^{N} |r_i - \hat{r}_i|
$$

#### ç¨‹å¼å¯¦ç¾

```python
def mae(self, true_ratings: np.ndarray, predicted_ratings: np.ndarray) -> float:
    return np.mean(np.abs(true_ratings - predicted_ratings))
```

**è©•ä¼°å‡½æ•¸ä¸­çš„è¨ˆç®—**ï¼š

```python
# æ”¶é›†èª¤å·®
absolute_errors.append(abs(true_rating - pred_rating))

# æœ€çµ‚çµæœ
mae = np.mean(absolute_errors)
```

#### è§£è®€
- **ç¯„åœ**ï¼š0 ~ âˆï¼ˆå¯¦éš›é€šå¸¸åœ¨ 0 ~ 5 ä¹‹é–“ï¼‰
- **è¶Šä½è¶Šå¥½**
- **MAE = 0.76** è¡¨ç¤ºï¼šå¹³å‡é æ¸¬èª¤å·®ç´„ç‚º 0.76 æ˜Ÿ
- **ç‰¹é»**ï¼š
  - å°ç•°å¸¸å€¼ä¸æ•æ„Ÿï¼ˆçµ•å°å€¼è€Œéå¹³æ–¹ï¼‰
  - æ›´ç›´è§€æ˜“æ‡‚
  - é€šå¸¸ **MAE < RMSE**ï¼ˆå› ç‚ºå¹³æ–¹é …æ”¾å¤§èª¤å·®ï¼‰
- **é©ç”¨å ´æ™¯**ï¼šéœ€è¦æ›´ç©©å¥ï¼ˆrobustï¼‰çš„è©•ä¼°ï¼Œå°é›¢ç¾¤å€¼ä¸æ•æ„Ÿ

#### MAE vs RMSE

| æŒ‡æ¨™ | å°å¤§èª¤å·® | å¯è§£é‡‹æ€§ | æ•¸å­¸æ€§è³ª |
| --- | --- | --- | --- |
| MAE | ç·šæ€§æ‡²ç½° | æ›´ç›´è§€ | ä¸å¯å¾®ï¼ˆçµ•å°å€¼ï¼‰ |
| RMSE | å¹³æ–¹æ‡²ç½° | è¼ƒè¤‡é›œ | å¯å¾® |

**ç¶“é©—æ³•å‰‡**ï¼š
- å¦‚æœ RMSE â‰ˆ MAEï¼Œèª¤å·®åˆ†å¸ƒè¼ƒå‡å‹»
- å¦‚æœ RMSE >> MAEï¼Œå­˜åœ¨è¼ƒå¤šå¤§èª¤å·®ï¼ˆé›¢ç¾¤å€¼ï¼‰

---

## ğŸ§ª Leave-One-Out è©•ä¼°ç­–ç•¥

### è©•ä¼°æµç¨‹

æœ¬å°ˆæ¡ˆæ¡ç”¨ **Leave-One-Out (LOO)** è©•ä¼°ç­–ç•¥ï¼Œå…·é«”æµç¨‹ï¼š

1. **é¸æ“‡æ¸¬è©¦æ¨£æœ¬**ï¼š
   - éš¨æ©ŸæŠ½å– N å€‹ä½¿ç”¨è€…ï¼ˆé è¨­500ï¼‰
   - ç¯©é¸è‡³å°‘æœ‰5æ¬¡è©•åˆ†çš„ä½¿ç”¨è€…

2. **ç¢ºå®šç›®æ¨™é …ç›®**ï¼š
   ```python
   target_idx_in_row = np.argmax(watched_ratings)
   target_movie_idx = watched_items[target_idx_in_row]
   ```
   é¸æ“‡ä½¿ç”¨è€…è©•åˆ†**æœ€é«˜**çš„é›»å½±ä½œç‚ºæ¸¬è©¦ç›®æ¨™

3. **ç”Ÿæˆæ¨è–¦åˆ—è¡¨**ï¼š
   ```python
   recommended = recommender.recommend_items(
       u_idx, train_matrix, user_features,
       top_n=10, target_item=target_movie_idx
   )
   ```
   æ¨è–¦ç³»çµ±éœ€è¦åœ¨ä¸çŸ¥é“ç›®æ¨™é›»å½±è©•åˆ†çš„æƒ…æ³ä¸‹ç”Ÿæˆ Top-K æ¨è–¦

4. **è¨ˆç®—è©•åˆ†é æ¸¬èª¤å·®**ï¼š
   ```python
   pred_rating = recommender.predict_rating(...)
   squared_errors.append((true_rating - pred_rating) ** 2)
   absolute_errors.append(abs(true_rating - pred_rating))
   ```

5. **è¨ˆç®—æ’åºæŒ‡æ¨™**ï¼š
   - æª¢æŸ¥ç›®æ¨™é›»å½±æ˜¯å¦åœ¨ Top-K ä¸­
   - å¦‚æœåœ¨ï¼Œè¨˜éŒ„å…¶æ’åä½ç½®
   - è¨ˆç®— Hitã€MRRã€NDCG

### èšåˆçµæœ

æ‰€æœ‰ä½¿ç”¨è€…çš„æŒ‡æ¨™å–**å¹³å‡å€¼**ï¼š

```python
results = {
    'n_samples': valid_samples,
    'hit_rate': hits / valid_samples,
    'precision': (hits / valid_samples) / top_n,
    'recall': hits / valid_samples,  # ç­‰æ–¼ hit_rate
    'mrr': np.mean(reciprocal_ranks),
    'ndcg': np.mean(ndcg_scores),
    'rmse': np.sqrt(np.mean(squared_errors)),
    'mae': np.mean(absolute_errors)
}
```

### Leave-One-Out çš„å„ªç¼ºé»

#### âœ… å„ªé»
1. **ç°¡å–®ç›´è§€**ï¼šæ¯å€‹ä½¿ç”¨è€…åªæœ‰ä¸€å€‹æ¸¬è©¦é …ç›®ï¼Œå®¹æ˜“ç†è§£
2. **å……åˆ†åˆ©ç”¨æ•¸æ“š**ï¼šè¨“ç·´é›†åŒ…å«å¹¾ä¹æ‰€æœ‰è©•åˆ†
3. **é©åˆå†·å•Ÿå‹•è©•ä¼°**ï¼šè€ƒé©—ç³»çµ±èƒ½å¦æ‰¾åˆ°ã€Œæœ€å–œæ­¡çš„é›»å½±ã€

#### âš ï¸ å±€é™æ€§
1. **æ¨‚è§€åå·®**ï¼šåªæ¸¬è©¦é«˜åˆ†é›»å½±ï¼Œæœªè€ƒæ…®ä½åˆ†é æ¸¬
2. **å–®ä¸€æ€§**ï¼šæ¯å€‹ä½¿ç”¨è€…åªæ¸¬è©¦ä¸€å€‹é …ç›®ï¼Œå¯èƒ½ä¸å¤ å…¨é¢
3. **è¨ˆç®—æˆæœ¬**ï¼šéœ€è¦ç‚ºæ¯å€‹æ¸¬è©¦æ¨£æœ¬é‡æ–°ç”Ÿæˆæ¨è–¦

---

## ğŸ“Š æŒ‡æ¨™é¸æ“‡æŒ‡å—

### ä¸åŒå ´æ™¯é©ç”¨çš„æŒ‡æ¨™

| è©•ä¼°ç›®æ¨™ | æ¨è–¦æŒ‡æ¨™ | åŸå›  |
| --- | --- | --- |
| æ¨è–¦åˆ—è¡¨å“è³ª | **Hit Rate@10, NDCG@10** | æ¥­ç•Œæœ€å¸¸ç”¨ï¼Œå…¼é¡§å‘½ä¸­èˆ‡æ’åº |
| è©•åˆ†é æ¸¬æº–ç¢ºåº¦ | **RMSE, MAE** | Netflix Prize æ¨™æº– |
| æœå°‹çµæœæ’åº | **MRR, MAP** | å¼·èª¿ç¬¬ä¸€å€‹çµæœçš„é‡è¦æ€§ |
| å¤šæ¨£æ€§èˆ‡è¦†è“‹ç‡ | **Recall@K, Coverage** | é¿å…åªæ¨è–¦ç†±é–€é …ç›® |
| A/B æ¸¬è©¦ | **Click-Through Rate (CTR)** | ç·šä¸ŠçœŸå¯¦ä½¿ç”¨è€…è¡Œç‚º |

### æœ¬å°ˆæ¡ˆçš„æŒ‡æ¨™é¸æ“‡

**æ ¸å¿ƒæŒ‡æ¨™**ï¼ˆå ±å‘Šä¸­é‡é»å±•ç¤ºï¼‰ï¼š
- âœ¨ **Hit Rate@10**ï¼šæœ€ç›´è§€çš„æ¨è–¦æˆåŠŸç‡
- âœ¨ **NDCG@10**ï¼šå…¼é¡§æ’åºå“è³ª
- âœ¨ **RMSE**ï¼šè©•åˆ†é æ¸¬æº–ç¢ºåº¦

**è¼”åŠ©æŒ‡æ¨™**ï¼š
- **MAE**ï¼šæ›´ç©©å¥çš„é æ¸¬èª¤å·®
- **Precision@10**ï¼šæ¨è–¦ç´”åº¦
- **MRR**ï¼šé¦–æ¬¡å‘½ä¸­ä½ç½®

### æŒ‡æ¨™é–“çš„é—œä¿‚

```
Hit Rate@10 = Recall@10 (in Leave-One-Out)
              â†“
         Precision@10 = Hit Rate / K
              â†“
         NDCG@10 è€ƒæ…®æ’åºä½ç½®ï¼ˆæ›´åš´æ ¼ï¼‰
              â†“
         MRR åªé—œæ³¨ç¬¬ä¸€å€‹å‘½ä¸­ï¼ˆæœ€åš´æ ¼ï¼‰
```

**åš´æ ¼ç¨‹åº¦**ï¼šMRR > NDCG > Hit Rate

---

## ğŸ¯ å¯¦é©—çµæœè§£è®€ç¯„ä¾‹

å‡è¨­å¯¦é©—20ï¼ˆæœ€ä½³é…ç½®ï¼‰å¾—åˆ°ä»¥ä¸‹çµæœï¼š

```python
{
    'n_samples': 500,
    'hit_rate': 0.6680,      # 66.8%
    'precision': 0.0668,     # 6.68%
    'recall': 0.6680,        # 66.8%
    'mrr': 0.4523,           # 45.23%
    'ndcg': 0.5280,          # 52.80%
    'rmse': 0.9753,          # 0.98 æ˜Ÿ
    'mae': 0.7612            # 0.76 æ˜Ÿ
}
```

### ğŸ“Š è§£è®€

**æ’åºå“è³ª**ï¼š
- âœ… **Hit Rate = 66.8%**ï¼šä¸‰åˆ†ä¹‹äºŒçš„ä½¿ç”¨è€…ï¼Œå…¶æœ€å–œæ­¡çš„é›»å½±å‡ºç¾åœ¨ Top-10 ä¸­
- âœ… **NDCG = 0.528**ï¼šæ’åºå“è³ªé”åˆ°ç†æƒ³ç‹€æ…‹çš„ 52.8%ï¼Œ**æ¥­ç•Œå„ªç§€æ°´æº–**ï¼ˆ>0.5ï¼‰
- âœ… **MRR = 0.452**ï¼šå¹³å‡è€Œè¨€ï¼Œç›®æ¨™é›»å½±å‡ºç¾åœ¨ç¬¬ 1/0.452 â‰ˆ **2.2 ä½**

**é æ¸¬æº–ç¢ºåº¦**ï¼š
- âœ… **RMSE = 0.975**ï¼šå¹³å‡é æ¸¬èª¤å·®ä¸åˆ° 1 æ˜Ÿï¼Œ**å„ªç§€æ°´æº–**ï¼ˆ<1.0ï¼‰
- âœ… **MAE = 0.761**ï¼šä¸­ä½æ•¸èª¤å·®ç´„ 0.76 æ˜Ÿ

**ç¶œåˆè©•åƒ¹**ï¼š
- æ¨è–¦ç³»çµ±åœ¨**æ’åºå“è³ª**å’Œ**é æ¸¬æº–ç¢ºåº¦**ä¸Šéƒ½é”åˆ°å„ªç§€æ°´æº–
- èƒ½æœ‰æ•ˆæ‰¾åˆ°ä½¿ç”¨è€…å–œæ„›çš„é›»å½±ä¸¦æ’åœ¨å‰åˆ—
- é æ¸¬èª¤å·®æ§åˆ¶åœ¨å¯æ¥å—ç¯„åœå…§

---

## ğŸ“š åƒè€ƒæ–‡ç»

1. **Hit Rate & Precision**: 
   - Cremonesi, P., et al. (2010). "Performance of recommender algorithms on top-n recommendation tasks." *RecSys*.

2. **NDCG**:
   - JÃ¤rvelin, K., & KekÃ¤lÃ¤inen, J. (2002). "Cumulated gain-based evaluation of IR techniques." *ACM TOIS*.

3. **MRR**:
   - Voorhees, E. M. (1999). "The TREC-8 Question Answering Track Report." *TREC*.

4. **RMSE**:
   - Netflix Prize: https://www.netflixprize.com/

5. **Leave-One-Out Evaluation**:
   - He, X., et al. (2017). "Neural Collaborative Filtering." *WWW*.

---

## ğŸ”§ ç¨‹å¼ç¢¼ä½ç½®

å®Œæ•´çš„è©•ä¼°æŒ‡æ¨™å¯¦ç¾ä½æ–¼ï¼š
- **æª”æ¡ˆ**ï¼š[src/movie_recommendation/evaluation.py](src/movie_recommendation/evaluation.py)
- **é¡åˆ¥**ï¼š`Evaluator`
- **ä¸»è¦æ–¹æ³•**ï¼š`evaluate_leave_one_out()`

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0  
**æœ€å¾Œæ›´æ–°**: 2026-01-02  
**ä½œè€…**: B1143015/æ—å®£ä½‘
