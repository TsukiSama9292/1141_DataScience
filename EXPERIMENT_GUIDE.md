# 🧪 實驗執行指南

本文件說明如何執行完整的 23 個系統性實驗，並記錄結果。

## 📋 實驗架構總覽

本研究共設計 **23 個實驗**，分為 **5 個階段**：

| 階段 | 實驗編號 | 研究問題 | 控制變因 | 變動變因 |
| --- | --- | --- | --- | --- |
| **階段1** | 1-4 | 資料量如何影響效果？ | 無SVD, KNN=20 | 資料量: 1M/5M/10M/20M |
| **階段2** | 5-11 | SVD最佳維度是多少？ | 20M資料, KNN=20 | SVD維度: 無/25/50/100/128/150/200 |
| **階段3** | 12-18 | KNN最佳鄰居數？ | 20M資料, SVD=128 | KNN鄰居: 10/20/30/40/50/75/100 |
| **階段4** | 19-20 | Item Bias效果？ | 20M, SVD=128, KNN=50 | Item Bias: 無/有 |
| **階段5** | 21-23 | 其他策略是否有效？ | 最佳基線 | 相似度放大/時間衰減/TF-IDF |

## 🚀 快速開始

### 1. 執行所有實驗

```bash
# 一次執行所有 23 個實驗
uv run python main.py
```

**注意**：完整執行約需 **30-40 分鐘**（視硬體配置）

### 2. 執行單一實驗

```bash
# 執行特定實驗
uv run python run/test01.py  # 實驗1
uv run python run/test20.py  # 實驗20（最佳配置）
```

### 3. 執行特定階段

```bash
# 階段1：資料量影響
for i in {01..04}; do uv run python run/test$i.py; done

# 階段2：SVD維度掃描
for i in {05..11}; do uv run python run/test$i.py; done

# 階段3：KNN鄰居數掃描
for i in {12..18}; do uv run python run/test$i.py; done

# 階段4：Item Bias效果
for i in {19..20}; do uv run python run/test$i.py; done

# 階段5：其他策略
for i in {21..23}; do uv run python run/test$i.py; done
```

## 📊 結果記錄

### 1. 查看日誌

每個實驗的詳細日誌保存在 `log/` 目錄：

```bash
# 查看特定實驗日誌
cat log/實驗1.log
cat log/實驗20.log

# 即時監控執行中的實驗
tail -f log/實驗20.log
```

### 2. 提取關鍵指標

實驗完成後，從日誌中提取以下指標填入 README.md：

```bash
# 範例：從日誌中提取指標
grep -E "Hit Rate@10|NDCG@10|RMSE|MAE|記憶體峰值|執行時間" log/實驗20.log
```

**需要記錄的指標**：
- Hit Rate@10
- NDCG@10
- RMSE
- MAE
- 記憶體峰值 (GB)
- 執行時間 (秒)

### 3. 更新 README.md

將實驗結果填入 [README.md](README.md) 的對應表格中：

1. 找到「階段N」的表格
2. 將標記「-」的欄位替換為實際數值
3. 填寫「各階段詳細分析」中的具體洞察

## 🎯 重點實驗建議

如果時間有限，建議優先執行以下**關鍵實驗**：

### 必須執行（10個）

| 實驗 | 理由 |
| --- | --- |
| **實驗1** | 最小基線 (1M無SVD) |
| **實驗4** | 全量無SVD基線 (20M) |
| **實驗5** | SVD掃描起點 (同實驗4) |
| **實驗7** | SVD=50 (與實驗9對比) |
| **實驗9** | SVD=128 (候選最優) |
| **實驗11** | SVD=200 (過擬合驗證) |
| **實驗13** | KNN掃描起點 (同實驗9) |
| **實驗16** | KNN=50 (候選最優) |
| **實驗19-20** | Item Bias對比 |

### 額外執行（核心洞察）

| 實驗 | 理由 |
| --- | --- |
| **實驗22** | 時間衰減負面結果 |
| **實驗23** | TF-IDF負面結果 |

## 📈 預期結果

### 階段1：資料量影響
- **預期趨勢**：Hit Rate 隨資料量增長而提升，但邊際效益遞減
- **關鍵發現**：1M → 5M 提升顯著，10M → 20M 提升趨緩

### 階段2：SVD維度掃描
- **預期曲線**：Hit Rate 隨維度增加先上升後趨平（可能略降）
- **最優維度**：預期在 **128維** 達到峰值
- **關鍵發現**：25-50維表達力不足，150-200維過擬合

### 階段3：KNN鄰居數掃描
- **預期曲線**：Hit Rate 先上升後趨平（可能略降）
- **最優鄰居**：預期在 **50鄰居** 達到峰值
- **關鍵發現**：10鄰居資訊不足，100鄰居引入噪音

### 階段4：Item Bias效果
- **預期差異**：
  - Hit Rate 提升 **8-10%**
  - RMSE 降低 **6-8%**
- **關鍵發現**：簡單策略帶來巨大收益

### 階段5：其他策略
- **實驗21（相似度放大）**：與實驗20持平
- **實驗22（時間衰減）**：Hit Rate **下降** 5-10%（負面結果）
- **實驗23（TF-IDF）**：Hit Rate **暴跌** 15-25%（負面結果）

## 🔧 故障排除

### 記憶體不足

如果記憶體小於 8GB，建議：

1. 僅執行小規模實驗（實驗1-2）
2. 修改 `n_samples` 參數：

```python
# 在實驗腳本中修改
config = ExperimentConfig(
    # ...
    n_samples=100,  # 從 500 降至 100
)
```

### 執行時間過長

如果單個實驗超過 5 分鐘，檢查：

1. 是否使用時間衰減（實驗22）或 TF-IDF（實驗23）？這兩個實驗較慢
2. 降低 `n_samples`（如上）
3. 確認 CPU 核心數：`n_jobs=-1` 應啟用所有核心

### 日誌未生成

確認 `log/` 目錄存在：

```bash
mkdir -p log
```

## 📝 實驗記錄模板

建議使用以下格式記錄實驗結果：

```markdown
### 實驗N結果

**配置**：
- 資料量: XXX
- SVD維度: XXX
- KNN鄰居: XXX
- Item Bias: 是/否
- 特殊策略: XXX

**指標**：
- Hit Rate@10: X.XXXX
- NDCG@10: X.XXXX
- RMSE: X.XXXX
- MAE: X.XXXX
- 記憶體峰值: X.X GB
- 執行時間: XX 秒

**觀察**：
- （此處填寫具體觀察與洞察）
```

## 🎓 學術報告建議

撰寫報告時，建議：

1. **重點突出對比**：
   - 實驗1 vs 實驗4（資料量影響）
   - 實驗5 vs 實驗9（SVD效果）
   - 實驗19 vs 實驗20（Item Bias效果）
   - 實驗20 vs 實驗22/23（負面結果）

2. **視覺化**：
   - 繪製「Hit Rate vs SVD維度」曲線（實驗5-11）
   - 繪製「Hit Rate vs KNN鄰居」曲線（實驗12-18）
   - 繪製各實驗的 Hit Rate / RMSE 對比柱狀圖

3. **強調負面結果**：
   - 實驗22-23 的負面結果**同樣具有學術價值**
   - 展現對領域特性的深入理解

4. **複現性聲明**：
   - 所有實驗使用 `random_state=42`
   - 提供完整腳本於 `run/` 目錄
   - 記錄硬體配置與執行環境

---

**祝實驗順利！**如有問題請查閱 [README.md](README.md) 或檢查日誌檔案。
